create table schm_workspace.unica_carga_camp ( "CAMPANA-ACUMULACION" VARCHAR(200), "CAMPANA-AHORRO_CANJES" VARCHAR(200), "CAMPANA-AHORRO_COMISION" VARCHAR(200), "CAMPANA-AHORRO_DESPACHOS" VARCHAR(200), "CAMPANA-AHORRO_OPEX" VARCHAR(200), "CAMPANA-AHORRO_SPOS" VARCHAR(200), "CAMPANA-AHORRO_FINAL" VARCHAR(200), "CAMPANA-AJUSTE" VARCHAR(200), "CAMPANA-AREA" VARCHAR(200), "CAMPANA-CADUCIDAD" VARCHAR(200), "CAMPANA-CAMPANA" VARCHAR(200), "CAMPANA-CAMPCODE" VARCHAR(200), "CAMPANA-CANAL" VARCHAR(200), "CAMPANA-CANJE" VARCHAR(200), "CAMPANA-CORREO" VARCHAR(200), "CAMPANA-CUSTOMERID" INTEGER, "CAMPANA-DIRECCION" VARCHAR(200), "CAMPANA-FECHA" VARCHAR(200), "CAMPANA-FECHASALDO" VARCHAR(200), "CAMPANA-ID_CLIENTE" INTEGER, "CAMPANA-ID_USUARIO" INTEGER, "CAMPANA-MARCA" VARCHAR(200), "CAMPANA-MODELO" VARCHAR(200), "CAMPANA-MONTO_AV" VARCHAR(200), "CAMPANA-MONTO_CONSUMO" VARCHAR(200), "CAMPANA-MONTO_CV" VARCHAR(200), "CAMPANA-MONTO_REF" VARCHAR(200), "CAMPANA-MONTO_SAV" VARCHAR(200), "CAMPANA-NOMBRE_PRODUCTO" VARCHAR(200), "CAMPANA-OTROS_COMERCIOS" VARCHAR(200), "CAMPANA-PATENTE" VARCHAR(200), "CAMPANA-PRODUCTO" VARCHAR(200), "CAMPANA-PRODUCTOS_FINANCIEROS" VARCHAR(200), "CAMPANA-PROP_CODIGO" VARCHAR(200), "CAMPANA-PTOS_A_CADUCAR" INTEGER, "CAMPANA-PUNTOS_A_CADUCAR" VARCHAR(200), "CAMPANA-PUNTOS_PROMOCIONALES" VARCHAR(200), "CAMPANA-RUT_PUSH" VARCHAR(200), "CAMPANA-SALDO_FINAL" VARCHAR(200), "CAMPANA-SALDO_INICIAL" VARCHAR(200), "CAMPANA-SALDO_TOTAL_TR" VARCHAR(200), "CAMPANA-SALDORPUNTOS" VARCHAR(200), "CAMPANA-SALDORPUNTOS1" VARCHAR(200), "CAMPANA-SEGMENTO" VARCHAR(200), "CAMPANA-SEGUROS" VARCHAR(200), "CAMPANA-SMS_MONTO_AV" VARCHAR(200), "CAMPANA-SMS_MONTO_CNS" VARCHAR(200), "CAMPANA-SMS_MONTO_CV" VARCHAR(200), "CAMPANA-SMS_MONTO_REF" VARCHAR(200), "CAMPANA-SMS_MONTO_SAV" VARCHAR(200), "CAMPANA-TELEFONO" VARCHAR(200), "CAMPANA-TELEFONO_SUCURSAL" VARCHAR(200), "CAMPANA-TIENDAS_RIPLEY" VARCHAR(200), "CAMPANA-TOTAL_ACUMULADO" VARCHAR(200), "CLIENTE-APELLIDO" VARCHAR(200), "CLIENTE-DIRECCION" VARCHAR(200), "CLIENTE-EMAIL" VARCHAR(200), "CLIENTE-FECHA_FACTURACION" VARCHAR(200), "CLIENTE-FECHA_LIMITE_PAGO" VARCHAR(200), "CLIENTE-ID_USUARIO" INTEGER, "CLIENTE-NOMBRE" VARCHAR(200), "CLIENTE-NOMBRE_TC" VARCHAR(200), "CLIENTE-NUM_TC" INTEGER, "CLIENTE-RETIRO_PLASTICO" INTEGER, "CLIENTE-TELEFONO_MOVIL" VARCHAR(200), "CAMPANA-SUCURSAL" VARCHAR(200), "CAMPANA-CANJEMILLAS" VARCHAR(200), "CAMPANA-MILLAS" VARCHAR(200), "CAMPANA-NRO_CANJE" INTEGER, "CAMPANA-CANJEGIFTCARD" VARCHAR(200), "CAMPANA-FECHA_VCTO_GC" VARCHAR(200), "CAMPANA-GIFTCARD" VARCHAR(200), "CAMPANA-IND_RUT_DUP_CAMP" INTEGER, "CAMPANA-VAR_CAMP_NUM_1" INTEGER, "CAMPANA-VAR_CAMP_NUM_2" INTEGER, "CAMPANA-VAR_CAMP_TXT_1" VARCHAR(200), "CAMPANA-VAR_CAMP_TXT_2" VARCHAR(200), "CLIENTE-DIRECCION_NUM" INTEGER, "CLIENTE-REGION" VARCHAR(200), "CLIENTE-COMUNA" VARCHAR(200), "CLIENTE-VAR_DM_NUM_1" INTEGER, "CLIENTE-VAR_DM_TXT_1" VARCHAR(200) ) INSERT INTO schm_workspace.unica_carga_camp ("CAMPANA-ACUMULACION","CAMPANA-AHORRO_CANJES","CAMPANA-AHORRO_COMISION","CAMPANA-AHORRO_DESPACHOS","CAMPANA-AHORRO_OPEX","CAMPANA-AHORRO_SPOS","CAMPANA-AHORRO_FINAL","CAMPANA-AJUSTE","CAMPANA-AREA","CAMPANA-CADUCIDAD","CAMPANA-CAMPANA","CAMPANA-CAMPCODE","CAMPANA-CANAL","CAMPANA-CANJE","CAMPANA-CORREO","CAMPANA-CUSTOMERID","CAMPANA-DIRECCION","CAMPANA-FECHA","CAMPANA-FECHASALDO","CAMPANA-ID_CLIENTE","CAMPANA-ID_USUARIO","CAMPANA-MARCA","CAMPANA-MODELO","CAMPANA-MONTO_AV","CAMPANA-MONTO_CONSUMO","CAMPANA-MONTO_CV","CAMPANA-MONTO_REF","CAMPANA-MONTO_SAV","CAMPANA-NOMBRE_PRODUCTO","CAMPANA-OTROS_COMERCIOS","CAMPANA-PATENTE","CAMPANA-PRODUCTO","CAMPANA-PRODUCTOS_FINANCIEROS","CAMPANA-PROP_CODIGO","CAMPANA-PTOS_A_CADUCAR","CAMPANA-PUNTOS_A_CADUCAR","CAMPANA-PUNTOS_PROMOCIONALES","CAMPANA-RUT_PUSH","CAMPANA-SALDO_FINAL","CAMPANA-SALDO_INICIAL","CAMPANA-SALDO_TOTAL_TR","CAMPANA-SALDORPUNTOS","CAMPANA-SALDORPUNTOS1","CAMPANA-SEGMENTO","CAMPANA-SEGUROS","CAMPANA-SMS_MONTO_AV","CAMPANA-SMS_MONTO_CNS","CAMPANA-SMS_MONTO_CV","CAMPANA-SMS_MONTO_REF","CAMPANA-SMS_MONTO_SAV","CAMPANA-TELEFONO","CAMPANA-TELEFONO_SUCURSAL","CAMPANA-TIENDAS_RIPLEY","CAMPANA-TOTAL_ACUMULADO","CLIENTE-APELLIDO","CLIENTE-DIRECCION","CLIENTE-EMAIL","CLIENTE-FECHA_FACTURACION","CLIENTE-FECHA_LIMITE_PAGO","CLIENTE-ID_USUARIO","CLIENTE-NOMBRE","CLIENTE-NOMBRE_TC","CLIENTE-NUM_TC","CLIENTE-RETIRO_PLASTICO","CLIENTE-TELEFONO_MOVIL","CAMPANA-SUCURSAL","CAMPANA-CANJEMILLAS","CAMPANA-MILLAS","CAMPANA-NRO_CANJE","CAMPANA-CANJEGIFTCARD","CAMPANA-FECHA_VCTO_GC","CAMPANA-GIFTCARD","CAMPANA-IND_RUT_DUP_CAMP","CAMPANA-VAR_CAMP_NUM_1","CAMPANA-VAR_CAMP_NUM_2","CAMPANA-VAR_CAMP_TXT_1","CAMPANA-VAR_CAMP_TXT_2","CLIENTE-DIRECCION_NUM","CLIENTE-REGION","CLIENTE-COMUNA","CLIENTE-VAR_DM_NUM_1","CLIENTE-VAR_DM_TXT_1") SELECT '1000','2000','3000','4000','5000','6000','7000','8000','AREA_BI_TEST','04/13/2021','TEST_NUEVO_CAMPANA','20230420TESTTODO','EMAIL','DAT_1','eb_jninaa@bancoripley.com','47856489','DIRECCION_1','04/13/2021','04/13/2021','47856489','47856489','DAT_2','DAT_3','DAT_4','DAT_5','DAT_6','DAT_7','DAT_8','DAT_9','DAT_10','DAT_11','DAT_12','DAT_13','DAT_14',1000000,'DAT_16','DAT_17','DAT_18','DAT_19','DAT_20','DAT_21','DAT_22','DAT_23','DAT_24','DAT_25','DAT_26','DAT_27','DAT_28','DAT_29','DAT_30','DAT_31','DAT_32','DAT_33','DAT_34','DAT_35','DAT_38','DAT_39','04/13/2021','04/13/2021','47856489','DAT_46','DAT_47',5940111,5940111,'DAT_54','ALONSO DE CORDOVA','CANJEMILLAS','MILLAS',200000,'CANJEGIFTCARD','FECHA_VCTO_GC','GIFTCARD',1,3333,4444,'VAR_CAMP_TXT_1','VAR_CAMP_TXT_2',2222,'REGION','COMUNA',1111,'VAR_DM_TXT_1' CREATE OR replace PROCEDURE schm_workspace.test_campaign2(IN v_nombre_campaing VARCHAR(40), IN v_user VARCHAR(20), IN v_fecha VARCHAR(20), IN v_query VARCHAR(1000)) AS $$ BEGIN EXECUTE 'UNLOAD(' || quote_literal(v_query) || ') to ''s3://br-dm-prod-us-east-1-837538682169-raw/bigdata/campaign/CAMPAIGN_INPUT_TR_CAMPANA/' || v_nombre_campaing || '_' || v_fecha || '_0-' || v_user || ''' iam_role ''arn:aws:iam::837538682169:role/ROLE-BR-PROD-DATA-MANAGEMENT-DATACATALOG-REDSHIFT'' format csv parallel off HEADER ALLOWOVERWRITE extension ''csv'' DELIMITER '','';'; RETURN; END; $$ LANGUAGE plpgsql; call schm_workspace.test_campaign2('CAMPAIGN_INPUT_TR_CAMPANA', 'JNINA', '20230320', 'select * from schm_workspace.unica_carga_camp');